app-id: net.waterfox.waterfox
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
command: waterfox
finish-args:
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=wayland
  - --socket=fallback-x11
  - --socket=cups
  - --persist=.waterfox
  - --filesystem=xdg-download:rw
  - --filesystem=xdg-desktop:rw
  - --filesystem=xdg-documents:rw
  - --filesystem=xdg-music:rw
  - --filesystem=xdg-pictures:rw
  - --filesystem=xdg-videos:rw
  - --filesystem=xdg-run/speech-dispatcher:ro
  - --filesystem=xdg-run/pipewire-0
  # Allow importing from other browsers
  - --filesystem=~/.mozilla:ro
  - --filesystem=~/snap:ro
  - --device=all
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.FileManager1
  - --talk-name=org.freedesktop.ScreenSaver
  - --talk-name=org.a11y.bus
  - --own-name=org.mozilla.waterfox.*
  - --own-name=org.mpris.MediaPlayer2.firefox.*
modules:
  - shared-modules/dbus-glib/dbus-glib.json
  - name: waterfox
    buildsystem: simple
    build-commands:
      - mkdir /app/opt
      - cp -r waterfox/ /app/opt/waterfox
      - desktop-file-install --dir /app/share/applications net.waterfox.waterfox.desktop
      - install -Dm644 /app/opt/waterfox/browser/chrome/icons/default/default256.png
        /app/share/icons/hicolor/256x256/apps/net.waterfox.waterfox.png
      - install -Dm644 net.waterfox.waterfox.metainfo.xml -t /app/share/metainfo
      - install -Dm644 flatpak-prefs.js -t /app/opt/waterfox/browser/defaults/preferences/
      - ln -sf /app/opt/waterfox/waterfox /app/bin/waterfox
    sources:
      - type: archive
        url: https://cdn.waterfox.com/waterfox/releases/6.6.9/Linux_x86_64/waterfox-6.6.9.tar.bz2
        sha256: ae6d2c7323a404b2973ed1f7b53c78c81c17fecc0d18666559e434d330c9400c
        dest: waterfox
        x-checker-data:
          type: html
          is-main-source: true
          url: https://www.waterfox.com/download/
          pattern: <a href="(https://cdn\.waterfox\.com/waterfox/releases/([0-9\.]+)/Linux_x86_64/waterfox-[0-9\.]+\.tar\.bz2)"
      - type: file
        path: net.waterfox.waterfox.metainfo.xml
      - type: file
        path: net.waterfox.waterfox.desktop
      - type: file
        path: flatpak-prefs.js
